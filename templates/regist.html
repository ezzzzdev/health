<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Re:Spring í”¼íŠ¸ë‹ˆìŠ¤ ì¶œì… í”„ë¡œê·¸ë¨-Regist</title>
    <link rel="stylesheet" type="text/css" href="/static/css/common.css" />
    <style>
      #inputBox {
        text-align: center;
        margin-top: 20px;
      }

      .inName {
        border-radius: 5px;
        border: solid 1px black;
        padding: 7px 3px;
      }

      #registerBox {
        text-align: center;
        margin-top: 20px;
      }

      #registerBox .regisBtn,
      .back {
        margin: 0 20px 0 20px;
        padding: 10px 20px;
        color: #03430c;
        background-color: #ffffff;
        border: solid 1px #03430c;
        text-align: center;
      }

      #registerBox .regisBtn:hover,
      .back:hover {
        text-shadow: 0 0 0 #ffffff;
        background-color: #03430c;
        color: #ffffff;
      }
    </style>
  </head>
  <body>
    <div id="mainBox">
      <a href="/" class="main_title">Re:Spring í”¼íŠ¸ë‹ˆìŠ¤ ğŸŒ·</a>
      <p class="sub_title">íšŒì› ì„¼í„° ì¶œì…</p>
    </div>

    <div id="video_container">
      <video
        id="webcam"
        class="re_v"
        width="640"
        height="480"
        autoplay
        muted="muted"
      ></video
      ><br />
    </div>

    <div id="inputBox">
      <input
        type="text"
        class="inName"
        id="userName"
        placeholder="ì˜ˆì‹œ í™ê¸¸ë™1234"
      />
      <label for="userName">'íšŒì›ëª…+ì „í™”ë²ˆí˜¸ ë’·ìë¦¬'ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</label
      ><br />
    </div>
    <div id="registerBox">
      <button class="regisBtn" id="registerButton">ì–¼êµ´ ë“±ë¡</button>
      <a class="back" href="/">ëŒì•„ê°€ê¸°</a>
    </div>
    <p id="resultMessage"></p>

    <script>
      // let registeredFace;
      const videoElement = document.getElementById("webcam");
      const registerButton = document.getElementById("registerButton");
      // const recognizeButton = document.getElementById('recognizeButton');
      const resultMessage = document.getElementById("resultMessage");
      // let isProcessingFrame = false;
      // const startRecognitionButton = document.getElementById('startRecognitionButton');

      // ì›¹ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¬ë°
      navigator.mediaDevices
        .getUserMedia({ video: true })
        .then((stream) => {
          videoElement.srcObject = stream;
          videoElement.play();
          // startFaceRecognition();
        })
        .catch((error) => {
          console.error("Error accessing webcam:", error);
          alert(
            "ì›¹ìº ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì›¹ìº  ê¶Œí•œê³¼ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ í™•ì¸í•´ì£¼ì„¸ìš”."
          );
        });

      // ë“±ë¡ëœ ì–¼êµ´ ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      registerButton.addEventListener("click", () => {
        const canvas = document.createElement("canvas");
        canvas.width = videoElement.width;
        canvas.height = videoElement.height;
        const context = canvas.getContext("2d");
        context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
        const imageDataURL = canvas.toDataURL("image/jpeg");
        const userName = document.getElementById("userName").value;

        // ìº”ë²„ìŠ¤ì—ì„œ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë°”ì´ë„ˆë¦¬ë¡œ ë³€í™˜
        canvas.toBlob((blob) => {
          const formData = new FormData();
          formData.append("image", blob, "image.jpg");
          formData.append("user_name", userName);

          // ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡
          fetch("/register_face", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.text())
            .then((data) => {
              // ì„œë²„ì—ì„œ ë°˜í™˜í•œ ë©”ì‹œì§€ë¥¼ alert ì°½ìœ¼ë¡œ ë„ìš°ê¸°
              alert(data);
            })
            .catch((error) => console.error("Error registering face:", error));
        }, "image/jpeg");
      });
    </script>
  </body>
</html>
